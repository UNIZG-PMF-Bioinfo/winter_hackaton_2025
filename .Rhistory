rf_model <- train(
disease ~ .,
data = trainData,
method = "ranger",
trControl = ctrl,
tuneGrid = tune_grid,
num.trees = 600,
importance = "impurity"
)
rf_model$finalModel
rf_model$bestTune
plot(rf_model)
#
table(predict(rf_model, testData), testData$disease) %>%
confusionMatrix()
## variable importance
varImp_rf <- varImp(rf_model)
plot(varImp_rf, top = 10)
#
table(predict(rf_model, testData), testData$disease) %>%
confusionMatrix()
t_num_micro[1:3,1:3]
varImp_rf
varImp_rf
rownames(varImp_rf)
as.data.table(varImp_rf)
rownames(varImp_rf$importance)
str_remove_all(rownames(varImp_rf$importance), "`")
t_num_micro[rownames(t_num_micro) %in% str_remove_all(rownames(varImp_rf$importance), "`"), ]
##
# plot
pheatmap(
t_num_micro[rownames(t_num_micro) %in% str_remove_all(rownames(varImp_rf$importance), "`"), ],
scale = "row",                   # Normalize each row
cluster_rows = TRUE,
cluster_cols = TRUE,
color = colorRampPalette(c("navy", "white", "firebrick3"))(50),
show_rownames = TRUE,
annotation_col = sample_annot
)
#
table(predict(rf_model, testData), testData$disease) %>%
confusionMatrix()
#
table(predict(rf_model, testData), testData$disease) %>%
confusionMatrix(., positive = "obesity")
table(predict(lasso_model, testData), testData$disease) %>%
confusionMatrix(.,  positive = "obesity")
# confusion matric
table(predict(glm_model, testData), testData$disease) %>%
confusionMatrix(.,  positive = "obesity")
# confusion matric
table(predict(glm_model, testData), testData$disease) %>%
confusionMatrix(.,  positive = "obesity")
table(predict(lasso_model, testData), testData$disease) %>%
confusionMatrix(.,  positive = "obesity")
#
table(predict(rf_model, testData), testData$disease) %>%
confusionMatrix(., positive = "obesity")
# plot
pheatmap(
t_num_micro,
scale = "row",                   # Normalize each row
cluster_rows = TRUE,
cluster_cols = TRUE,
color = colorRampPalette(c("navy", "white", "firebrick3"))(50),
show_rownames = TRUE,
annotation_col = sample_annot
)
# plot
pheatmap(
t_num_micro,
scale = "row",                   # Normalize each row
cluster_rows = TRUE,
cluster_cols = TRUE,
color = colorRampPalette(c("navy", "white", "firebrick3"))(50),
show_rownames = TRUE,
annotation_col = sample_annot
)
# plot
pheatmap(
t_num_micro,
scale = "row",                   # Normalize each row
cluster_rows = TRUE,
cluster_cols = TRUE,
color = colorRampPalette(c("navy", "white", "firebrick3"))(50),
show_rownames = TRUE,
annotation_col = sample_annot
)
# I have 9 highly correlated
to_remove
test_data <- fread("../hackaton25/Project_microbiome_obesity/Mirobiome_TEST.csv.gz")
test_data
test_data[disease == "n"]
test_data_known <- test_data[disease != "n"]
test_data_unknown <- test_data[disease == "n"]
test_data_known <- test_data[disease != "n"]
test_data_unknown <- test_data[disease == "n"]
# on new dataset---------------
table(predict(glm_model, test_data_known), test_data_known$Stage) %>%
confusionMatrix()
table(predict(glm_model, test_data_known), test_data_known$disease) %>%
confusionMatrix()
table(predict(lasso_model, test_data_known), test_data_known$disease) %>%
confusionMatrix()
table(predict(rf_model, test_data_known), test_data_known$disease) %>%
confusionMatrix()
table(predict(rf_model, test_data_known), test_data_known$disease) %>%
confusionMatrix()
table(predict(lasso_model, test_data_known), test_data_known$disease) %>%
confusionMatrix()
# on new dataset---------------
table(predict(glm_model, test_data_known), test_data_known$disease) %>%
confusionMatrix()
table(predict(rf_model, test_data_known), test_data_known$disease) %>%
confusionMatrix()
# on new dataset---------------
table(predict(glm_model, test_data_known), test_data_known$disease) %>%
confusionMatrix()
table(predict(lasso_model, test_data_known), test_data_known$disease) %>%
confusionMatrix()
table(predict(rf_model, test_data_known), test_data_known$disease) %>%
confusionMatrix()
table(predict(rf_model, test_data_known), test_data_known$disease) %>%
confusionMatrix(., positive = "obesity")
### on uknown samples -------------
predict(rf_model, test_data_unknown)
### on uknown samples -------------
test_data_unknown[, pred_clas := predict(rf_model, test_data_unknown)]
test_data_unknown
### on uknown samples -------------
test_data_unknown[, pred_class := predict(rf_model, test_data_unknown)]
test_data_unknown %>%
ggplot(., aes(x=pred_class, y=bmi)) +
geom_boxplot()
test_data_unknown %>%
ggplot(., aes(x=pred_class, y=bmi)) +
geom_point()
test_data_unknown %>%
ggplot(., aes(x=pred_class, y=bmi)) +
geom_jitter()
test_data_unknown %>%
ggplot(., aes(x=pred_class, y=bmi)) +
geom_boxplot()
test_data_unknown %>%
ggplot(., aes(x=pred_class, y=bmi)) +
geom_boxplot() +
geom_jitter()
setwd("C:/Users/Paula/OneDrive/Work/KC_work/IRB_radionica_25/WEB_IRB25/Projects/project_obesity")
## microbiome project -----------------------------------
(microbiome <- fread("gut_obesity_subset.csv"))
microbiome[, .N, disease]
# randomly select few samples to additional independent test
set.seed(42)
micro_test <- rbind(microbiome[disease=="n"],
microbiome[disease=="obesity"][sample(1:.N,size = 20)],
microbiome[disease=="leaness"][sample(1:.N,size = 10)]
)
fwrite(micro_test, "../../../../../Courses/course_2025_2026/MLSTAT/hackaton25/Project_microbiome_obesity/Mirobiome_TEST.csv.gz")
microbiome_subset <- microbiome[!sampleID %in% micro_test$sampleID]
microbiome_subset
microbiome_subset[, SantaClaus := "No"]
setwd("C:/Users/Paula/OneDrive/Work/KC_work/IRB_radionica_25/WEB_IRB25/Projects/project_obesity")
## microbiome project -----------------------------------
(microbiome <- fread("gut_obesity_subset.csv"))
microbiome[, .N, disease]
# randomly select few samples to additional independent test
set.seed(42)
micro_test <- rbind(microbiome[disease=="n"],
microbiome[disease=="obesity"][sample(1:.N,size = 20)],
microbiome[disease=="leaness"][sample(1:.N,size = 10)]
)
micro_test[, SantaClaus := "No"]
micro_test
micro_test[order(BMI)]
micro_test[order(bmi)]
micro_test[order(bmi),.(bmi, sampleID)]
setwd("C:/Users/Paula/OneDrive/Work/KC_work/IRB_radionica_25/WEB_IRB25/Projects/project_obesity")
## microbiome project -----------------------------------
(microbiome <- fread("gut_obesity_subset.csv"))
microbiome[, .N, disease]
# randomly select few samples to additional independent test
set.seed(42)
micro_test <- rbind(microbiome[disease=="n"],
microbiome[disease=="obesity"][sample(1:.N,size = 20)],
microbiome[disease=="leaness"][sample(1:.N,size = 10)]
)
micro_test[, SantaClaus := "No"]
micro_test[sampleID =="MH0440",SantaClaus := "Yes"]
fwrite(micro_test, "../../../../../Courses/course_2025_2026/MLSTAT/hackaton25/Project_microbiome_obesity/Mirobiome_TEST.csv.gz")
setwd("C:/Users/Paula/OneDrive/Work/KC_work/IRB_radionica_25/WEB_IRB25/Projects/project_obesity")
## microbiome project -----------------------------------
(microbiome <- fread("gut_obesity_subset.csv"))
microbiome[, .N, disease]
# randomly select few samples to additional independent test
set.seed(42)
micro_test <- rbind(microbiome[disease=="n"],
microbiome[disease=="obesity"][sample(1:.N,size = 20)],
microbiome[disease=="leaness"][sample(1:.N,size = 10)]
)
micro_test[, SantaClaus := "No"]
micro_test[sampleID =="MH0440",SantaClaus := "Yes"]
fwrite(micro_test, "../../../../../Courses/course_2025_2026/MLSTAT/hackaton25/Project_microbiome_obesity/Mirobiome_TEST.csv.gz")
microbiome_subset <- microbiome[!sampleID %in% micro_test$sampleID]
microbiome_subset[, SantaClaus := "No"]
fwrite(microbiome_subset, "../../../../../Courses/course_2025_2026/MLSTAT/hackaton25/Project_microbiome_obesity/Mirobiome_subset.csv.gz")
setwd("C:/Users/Paula/OneDrive/Work/KC_work/IRB_radionica_25/WEB_IRB25/Projects/project_cancer/")
whole_cancer <- data.table::fread("lung_cancer_data.csv.zip")
# filter for those with low and high stage
cancer_stage <- whole_cancer[Stage %in% c("Stage I", "Stage IV")]
cancer_stage[, SantaClaus := "No"]
setwd("C:/Users/Paula/OneDrive/Work/KC_work/IRB_radionica_25/WEB_IRB25/Projects/project_cancer/")
whole_cancer <- data.table::fread("lung_cancer_data.csv.zip")
# filter for those with low and high stage
cancer_stage <- whole_cancer[Stage %in% c("Stage I", "Stage IV")]
cancer_stage[, SantaClaus := "No"]
# randomly select for testing
set.seed(42)
cancer_subset <- cancer_stage[sample(1:.N, size = 300)]
fwrite(cancer_subset, "../../../../../Courses/course_2025_2026/MLSTAT/hackaton25/Project_lung_cancer/Lung_cancer_subset.csv.gz")
cancer_test <- cancer_stage[!Patient_ID %in% cancer_subset$Patient_ID][sample(1:.N, size = 50)]
cancer_test
cancer_test[Gender=="Male"]
cancer_test[Gender=="Male" & Ethnicity == "Caucasian"]
cancer_test[Gender=="Male" & Ethnicity == "Caucasian"][Glucose_Level == max(Glucose_Level)]
setwd("C:/Users/Paula/OneDrive/Work/KC_work/IRB_radionica_25/WEB_IRB25/Projects/project_cancer/")
whole_cancer <- data.table::fread("lung_cancer_data.csv.zip")
# filter for those with low and high stage
cancer_stage <- whole_cancer[Stage %in% c("Stage I", "Stage IV")]
cancer_stage[, SantaClaus := "No"]
# randomly select for testing
set.seed(42)
cancer_subset <- cancer_stage[sample(1:.N, size = 300)]
fwrite(cancer_subset, "../../../../../Courses/course_2025_2026/MLSTAT/hackaton25/Project_lung_cancer/Lung_cancer_subset.csv.gz")
cancer_test <- cancer_stage[!Patient_ID %in% cancer_subset$Patient_ID][sample(1:.N, size = 50)]
cancer_test[Gender=="Male" & Ethnicity == "Caucasian"][Glucose_Level == max(Glucose_Level)]
cancer_test[Patient_ID == "Patient15307", SantaClaus := "Yes"]
fwrite(cancer_test, "../../../../../Courses/course_2025_2026/MLSTAT/hackaton25/Project_lung_cancer/Lung_cancer_TEST.csv.gz")
rm(list=ls())
setwd("C:/Users/Paula/OneDrive/Work/Courses/course_2025_2026/MLSTAT/hackaton25/winter_hackaton25")
microbiome <- fread("Project_microbiome_obesity/Mirobiome_subset.csv.gz")
microbiome
microbiome_clean <- microbiome[,-c("dataset_name", "sampleID", "bodysite", "SantaClaus", "disease")]
microbiome_clean
# Splitting data into training and testing sets
trainIndex <- createDataPartition(microbiome_clean$bmi,
p = 0.8,
list = FALSE,
times = 1)
trainData <- microbiome_clean[trainIndex, ]
testData <- microbiome_clean[-trainIndex, ]
trainData
testData
summary(trainData$bmi)
summary(testData$bmi)
ctrl <- trainControl(
method = "cv",
number = 10,
classProbs = TRUE,
summaryFunction = twoClassSummary,
savePredictions = "final"
)
## develop a model only on those significant features
glm_model <- train(
bmi ~ .,
data = trainData,
method = "glm",
trControl = ctrl    # usually trainControl(...)
)
ctrl <- trainControl(
method = "cv",
number = 10,
classProbs = TRUE,
summaryFunction = twoClassSummary,
savePredictions = "final"
)
## develop a model only on those significant features
glm_model <- train(
bmi ~ .,
data = trainData,
method = "glm",
trControl = ctrl    # usually trainControl(...)
)
ctrl <- trainControl(
method = "cv",
number = 10,)
## develop a model only on those significant features
glm_model <- train(
bmi ~ .,
data = trainData,
method = "glm",
trControl = ctrl    # usually trainControl(...)
)
# Compute correlation matrix
corr_mat <- cor(trainData[,.SD,.SDcols=is.numeric],
use = "pairwise.complete.obs")
# Find columns to remove (threshold example: 0.8)
to_remove <- findCorrelation(corr_mat,
cutoff = 0.8,
names=TRUE)
# I have 9 highly correlated
to_remove
# remove highly correlated features
trainData[, (to_remove) := NULL]
ctrl <- trainControl(
method = "cv",
number = 10,)
## develop a model only on those significant features
glm_model <- train(
bmi ~ .,
data = trainData,
method = "glm",
trControl = ctrl    # usually trainControl(...)
)
# confusion matric
table(predict(glm_model, testData), testData$disease) %>%
confusionMatrix(.,  positive = "obesity")
glm_model
table(predict(glm_model, testData), testData$disease) %>%
confusionMatrix(.,  positive = "obesity")
# confusion matric
predict(glm_model, testData)
# confusion matric
postResample(predict(glm_model, testData), testData$bmi)
?postResample
testData$bmi
predict(glm_model, testData)
testData$bmi
lasso_grid <- expand.grid(
alpha = 1,                          # LASSO
lambda = 10^seq(-4, 2, length = 50) # candidate penalties
)
lasso_model <- train(
bmi ~ .,
data = trainData,
method = "glmnet",
trControl = ctrl
)
# asses quality
postResample(predict(lasso_model, testData), testData$bmi)
# confusion matric
postResample(predict(glm_model, testData), testData$bmi)
# asses quality
postResample(predict(lasso_model, testData), testData$bmi)
# significant coefficients
coef(lasso_model$finalModel, lasso_model$bestTune$lambda)
trainData
# 2) Define a tuning grid for mtry (36 predictors → try a range)
tune_grid <- expand.grid(
mtry          = c(2:4, 8, 10),
splitrule     = c("gini"),
min.node.size = c(1, 3, 5)
)
# 3) Train RF with hyperparameter tuning
set.seed(123)
rf_model <- train(
bmi ~ .,
data = trainData,
method = "ranger",
trControl = ctrl,
tuneGrid = tune_grid,
num.trees = 600,
importance = "impurity"
)
tune_grid <- expand.grid(
+   mtry          = c(2:4, 8, 10),
tune_grid <- expand.grid(
+   mtry          = c(2:4, 8, 10),
ctrl
ctrl <- trainControl(
method = "cv",
number = 10)
rf_model <- train(
bmi ~ .,
data = trainData,
method = "ranger",
trControl = ctrl,
tuneGrid = tune_grid,
num.trees = 600,
importance = "impurity"
)
rf_model <- train(
bmi ~ .,
data = trainData,
method = "ranger",
trControl = ctrl,
tuneGrid = tune_grid,
num.trees = 600,
importance = "impurity",
metric = "RMSE"
)
tune_grid <- expand.grid(
mtry          = c(2:4, 8, 10),
splitrule     = c("gini"),
min.node.size = c(1, 3, 5)
)
ctrl <- trainControl(
method = "cv",
number = 10,
search = "grid"
)
# 3) Train RF with hyperparameter tuning
set.seed(123)
rf_model <- train(
bmi ~ .,
data = trainData,
method = "ranger",
trControl = ctrl,
tuneGrid = tune_grid,
num.trees = 600,
importance = "impurity",
metric = "RMSE"
)
rf_model <- train(
bmi ~ .,
data = trainData,
method = "ranger",
trControl = ctrl,
tuneGrid = tune_grid,
num.trees = 600,
importance = "impurity",
metric = "RMSE"
)
rf_model <- train(
bmi ~ .,
data = trainData,
method = "ranger",
trControl = ctrl,
tuneGrid = tune_grid,
num.trees = 600,
importance = "impurity",
metric = "RMSE"
)
# 2) Define a tuning grid for mtry (36 predictors → try a range)
tune_grid <- expand.grid(
mtry          = c(2:4, 8, 10),
splitrule     = c("variance", "extratrees"),
min.node.size = c(1, 3, 5)
)
ctrl <- trainControl(
method = "cv",
number = 10,
search = "grid"
)
# 3) Train RF with hyperparameter tuning
set.seed(123)
rf_model <- train(
bmi ~ .,
data = trainData,
method = "ranger",
trControl = ctrl,
tuneGrid = tune_grid,
num.trees = 600,
importance = "impurity",
metric = "RMSE"
)
rf_model$finalModel
rf_model$bestTune
plot(rf_model)
#
postResample(predict(rf_model, testData), testData$bmi)
## variable importance
varImp_rf <- varImp(rf_model)
plot(varImp_rf, top = 10)
test_data <- fread("../hackaton25/Project_microbiome_obesity/Mirobiome_TEST.csv.gz")
test_data_known <- test_data[disease != "n"]
test_data_unknown <- test_data[disease == "n"]
# on new dataset---------------
postResample(predict(glm_model, test_data), test_data$bmi)
postResample(predict(lasso_model, test_data), test_data$bmi)
postResample(predict(rf_model, test_data), test_data$bmi)
test_data
### on uknown samples ---------------------------
test_data[SantaClaus == "Yes"]
postResample(predict(rf_model, test_data), test_data$bmi)
### on uknown samples ---------------------------
test_data[SantaClaus == "Yes"]
### luad data gene expression
library(data.table)
lung <- readRDS("projects/TCGA-LUAD_expr.rds")
lung[1:3,1:3]
dim(lung)
library(TCGAbiolinks)
# ---- 1. Query clinical data ----
clin_query <- GDCquery(
project = "TCGA-LUAD",
data.category = "Clinical",
file.type = "xml"
)
# ---- 1. Query clinical data ----
clin_query <- GDCquery(
project = "TCGA-LUAD",
data.category = "Clinical"
)
# ---- 2. Download ----
GDCdownload(clin_query)
# ---- 1. Query clinical data ----
clin_query <- GDCquery(
project = "TCGA-LUAD",
data.category = "Clinical",
file.type = "Clinical Supplement"
)
clin_luad <- GDCquery_clinic(project = "TCGA-LUAD", type = "clinical")
clin_query <- GDCquery(
project = "TCGA-LUAD",
data.category = "Clinical",
data.type = "Clinical Supplement",
access = "open"
)
GDCdownload(clin_query)
# Extract and convert XML to tables
patient   <- GDCprepare_clinic(clin_query, clinical.info = "patient")
